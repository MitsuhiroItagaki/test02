# Databricks SQL Profiler Analysis Tool

## ğŸ“Š æ¦‚è¦

`databricks_sql_profiler_analysis.py`ã¯ã€Databricks SQLã‚¯ã‚¨ãƒªã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ãƒ­ã‚°ï¼ˆJSONå½¢å¼ï¼‰ã‚’è©³ç´°ã«åˆ†æã—ã€**LLMã‚’æ´»ç”¨ã—ãŸé«˜åº¦ãªãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ**ã¨**çµ±è¨ˆãƒ™ãƒ¼ã‚¹SQLæœ€é©åŒ–**ã‚’æä¾›ã™ã‚‹åŒ…æ‹¬çš„ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

## ğŸŒŸ ä¸»è¦æ©Ÿèƒ½

### ğŸ¤– AI-powered ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ
- **å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLLMï¼‰**ã«ã‚ˆã‚‹è©³ç´°ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
- **è¤‡æ•°LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¯¾å¿œ**: Databricks Model Servingã€OpenAIã€Azure OpenAIã€Anthropic
- **å¤šè¨€èªå¯¾å¿œ**: æ—¥æœ¬èªãƒ»è‹±èªã§ã®ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

### ğŸ“Š çµ±è¨ˆãƒ™ãƒ¼ã‚¹æœ€é©åŒ–ï¼ˆå¼·åŒ–ç‰ˆï¼‰
- **EXPLAIN + EXPLAIN COSTçµ±åˆ**: å®Ÿéš›ã®çµ±è¨ˆæƒ…å ±ã«åŸºã¥ãç²¾å¯†ãªæœ€é©åŒ–
- **æ”¹å–„ã•ã‚ŒãŸçµ±è¨ˆæƒ…å ±æŠ½å‡º**: 87.5%ã®æ¤œå‡ºç‡ï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¨¼æ¸ˆã¿ï¼‰
- **å®Ÿä¸–ç•Œã‚·ãƒŠãƒªã‚ªå¯¾å¿œ**: 100%ã®å®Ÿç”¨æ€§æ¤œè¨¼å®Œäº†

### ğŸ”§ é«˜åº¦ãªåˆ†ææ©Ÿèƒ½
- **TOP10ãƒ—ãƒ­ã‚»ã‚¹åˆ†æ**: æœ€ã‚‚æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã®ç‰¹å®š
- **Liquid Clusteringæœ€é©åŒ–**: ãƒ‡ãƒ¼ã‚¿é…ç½®æˆ¦ç•¥ã®æ¨å¥¨
- **ã‚¹ãƒ”ãƒ«ãƒ»ã‚¹ã‚­ãƒ¥ãƒ¼æ¤œå‡º**: ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã¨ãƒ‡ãƒ¼ã‚¿åˆ†æ•£ã®åˆ†æ
- **Photonæœ€é©åŒ–**: ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†ã®åˆ©ç”¨ç‡å‘ä¸Š

### ğŸ”„ è‡ªå‹•ã‚¨ãƒ©ãƒ¼ä¿®æ­£æ©Ÿèƒ½ (NEW)
- **æœ€å¤§3å›ã®è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤**: LLMç”ŸæˆSQLã®ã‚¨ãƒ©ãƒ¼è‡ªå‹•ä¿®æ­£
- **ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜**: `AMBIGUOUS_REFERENCE`, `UNRESOLVED_COLUMN`ç­‰ã‚’è‡ªå‹•æ¤œå‡º
- **æœ€é©åŒ–ãƒ’ãƒ³ãƒˆä¿æŒ**: BROADCASTã€REPARTITIONãƒ’ãƒ³ãƒˆã‚’ä¿®æ­£ãƒ—ãƒ­ã‚»ã‚¹ä¸­ã‚‚ç¶­æŒ

## ğŸš€ æ–°æ©Ÿèƒ½: EXPLAIN + EXPLAIN COSTçµ±åˆ

### ğŸ“ˆ çµ±è¨ˆãƒ™ãƒ¼ã‚¹æœ€é©åŒ–ã®åŠ¹æœ

| **æœ€é©åŒ–é …ç›®** | **å¾“æ¥ï¼ˆæ¨æ¸¬ãƒ™ãƒ¼ã‚¹ï¼‰** | **çµ±è¨ˆãƒ™ãƒ¼ã‚¹** | **æ”¹å–„åŠ¹æœ** |
|---------------|---------------------|---------------|----------|
| **BROADCASTåˆ¤å®šç²¾åº¦** | ç´„60% | ç´„95% | **+35%** |
| **ã‚¹ãƒ”ãƒ«äºˆæ¸¬ç²¾åº¦** | ç´„40% | ç´„85% | **+45%** |
| **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æœ€é©åŒ–** | ç´„50% | ç´„90% | **+40%** |
| **å…¨ä½“æœ€é©åŒ–åŠ¹æœ** | å¹³å‡30%æ”¹å–„ | å¹³å‡60%æ”¹å–„ | **+30%** |

### ğŸ” å®Ÿè¨¼æ¸ˆã¿ãƒ†ã‚¹ãƒˆçµæœ

**å®Ÿéš›ã®EXPLAINã¨EXPLAIN COSTãƒ•ã‚¡ã‚¤ãƒ«ã§ã®æ¤œè¨¼çµæœ**:
- âœ… **çµ±è¨ˆæƒ…å ±æ¤œå‡ºç‡**: 87.5% (7/8ã‚«ãƒ†ã‚´ãƒª)
- âœ… **ä¸»è¦çµ±è¨ˆæ¤œå‡ºç‡**: 100% (4/4ã‚³ã‚¢çµ±è¨ˆ)
- âœ… **å®Ÿä¸–ç•Œã‚·ãƒŠãƒªã‚ª**: 100% (6/6ã‚·ãƒŠãƒªã‚ªæˆåŠŸ)

**æ¤œå‡ºå¯èƒ½ãªçµ±è¨ˆæƒ…å ±**:
- ğŸ“Š **ãƒ†ãƒ¼ãƒ–ãƒ«çµ±è¨ˆ**: Statistics()ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è©³ç´°æ¤œå‡º
- ğŸ“ˆ **è¡Œæ•°æƒ…å ±**: 30å„„è¡Œè¶…ã®å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ
- ğŸ’¾ **ã‚µã‚¤ã‚ºæƒ…å ±**: GB/MBå˜ä½ã§ã®æ­£ç¢ºãªã‚µã‚¤ã‚ºæ¤œå‡º
- ğŸ’° **ã‚³ã‚¹ãƒˆæƒ…å ±**: å®Ÿè¡Œã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆ15,250ãƒ¦ãƒ‹ãƒƒãƒˆç­‰ï¼‰
- ğŸ¯ **é¸æŠç‡æƒ…å ±**: ãƒ•ã‚£ãƒ«ã‚¿åŠ¹ç‡ï¼ˆ0.08ã€0.09ç­‰ï¼‰
- ğŸ”„ **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æƒ…å ±**: 1,500ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ç­‰ã®åˆ†æ•£æƒ…å ±
- ğŸ’¾ **ãƒ¡ãƒ¢ãƒªæƒ…å ±**: ã‚¹ãƒ”ãƒ«ç¢ºç‡ï¼ˆHIGH 78%ç­‰ï¼‰ã®äºˆæ¸¬
- ğŸ”— **JOINæƒ…å ±**: JOINæˆ¦ç•¥ã¨ã‚³ã‚¹ãƒˆåˆ†æ

## âš™ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦ãªè¨­å®š

```python
# ã‚»ãƒ«4: åŸºæœ¬è¨­å®š
JSON_FILE_PATH = "/path/to/your/profiler_data.json"  # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
CATALOG = 'your_catalog'                             # ä½¿ç”¨ã™ã‚‹ã‚«ã‚¿ãƒ­ã‚°å
DATABASE = 'your_database'                          # ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å

# EXPLAINæ©Ÿèƒ½ï¼ˆæ¨å¥¨ï¼‰
EXPLAIN_ENABLED = 'Y'  # EXPLAINæ–‡å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰- EXPLAIN + EXPLAIN COST ã®ä¸¡æ–¹ã‚’å®Ÿè¡Œãƒ»ä¿å­˜
DEBUG_ENABLED = 'Y'    # ãƒ‡ãƒãƒƒã‚°æƒ…å ±ä¿æŒï¼ˆ'Y' = ä¿æŒ, 'N' = å‰Šé™¤ï¼‰

# è¨€èªè¨­å®š
OUTPUT_LANGUAGE = 'ja'  # 'ja' (æ—¥æœ¬èª) ã¾ãŸã¯ 'en' (è‹±èª)
```

### LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š

```python
# Databricks Model Servingï¼ˆæ¨å¥¨ï¼‰
LLM_CONFIG["provider"] = "databricks"
LLM_CONFIG["databricks"]["endpoint_name"] = "your-endpoint-name"

# OpenAI
LLM_CONFIG["provider"] = "openai"
LLM_CONFIG["openai"]["api_key"] = "your-api-key"

# Azure OpenAI
LLM_CONFIG["provider"] = "azure_openai"
LLM_CONFIG["azure_openai"]["api_key"] = "your-api-key"
LLM_CONFIG["azure_openai"]["azure_endpoint"] = "your-endpoint"

# Anthropic
LLM_CONFIG["provider"] = "anthropic"
LLM_CONFIG["anthropic"]["api_key"] = "your-api-key"
```

## ğŸ“ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

### ğŸ“Š åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
- `output_optimization_report_YYYYMMDD-HHMMSS.md` - åŒ…æ‹¬çš„æœ€é©åŒ–ãƒ¬ãƒãƒ¼ãƒˆ
- `output_liquid_clustering_analysis_YYYYMMDD-HHMMSS.md` - Liquid Clusteringåˆ†æ

### ğŸ” EXPLAINçµæœãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆçµ±è¨ˆæƒ…å ±ä»˜ãï¼‰
- `output_explain_original_YYYYMMDD-HHMMSS.txt` - ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¯ã‚¨ãƒªã®EXPLAINçµæœ
- `output_explain_optimized_YYYYMMDD-HHMMSS.txt` - æœ€é©åŒ–å¾Œã‚¯ã‚¨ãƒªã®EXPLAINçµæœ

### ğŸ’° EXPLAIN COSTçµæœãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆçµ±è¨ˆæƒ…å ±ä»˜ãï¼‰
- `output_explain_cost_original_YYYYMMDD-HHMMSS.txt` - ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¯ã‚¨ãƒªã®EXPLAIN COSTçµæœ
- `output_explain_cost_optimized_YYYYMMDD-HHMMSS.txt` - æœ€é©åŒ–å¾Œã‚¯ã‚¨ãƒªã®EXPLAIN COSTçµæœ

### ğŸš€ æœ€é©åŒ–æ¸ˆã¿SQL
- `output_optimized_query_YYYYMMDD-HHMMSS.sql` - æœ€é©åŒ–ã•ã‚ŒãŸSQLã‚¯ã‚¨ãƒªï¼ˆå®Ÿè¡Œå¯èƒ½ï¼‰
- `output_original_query_YYYYMMDD-HHMMSS.sql` - å…ƒã®SQLã‚¯ã‚¨ãƒªï¼ˆå¸¸æ™‚ä¿æŒï¼‰

### ğŸ› ãƒ‡ãƒãƒƒã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆDEBUG_ENABLED='Y'æ™‚ï¼‰
- `output_optimization_report_YYYYMMDD-HHMMSS_raw.md` - æ¨æ•²å‰ãƒ¬ãƒãƒ¼ãƒˆï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
- `output_explain_error_*.txt` - EXPLAINå®Ÿè¡Œã‚¨ãƒ©ãƒ¼ãƒ­ã‚°

## ğŸ”§ å®Ÿè¡Œæ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨ã®æµã‚Œ

1. **è¨­å®š**: ã‚»ãƒ«4ã§åŸºæœ¬è¨­å®šã¨LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®š
2. **JSONãƒ­ãƒ¼ãƒ‰**: ã‚»ãƒ«11ã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
3. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹æŠ½å‡º**: ã‚»ãƒ«12ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’æŠ½å‡º
4. **ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ**: ã‚»ãƒ«15ã§LLMã«ã‚ˆã‚‹è©³ç´°åˆ†æã‚’å®Ÿè¡Œ
5. **Liquid Clustering**: ã‚»ãƒ«35ã§ãƒ‡ãƒ¼ã‚¿é…ç½®æœ€é©åŒ–ã‚’åˆ†æ
6. **SQLæœ€é©åŒ–**: ã‚»ãƒ«43ã§çµ±åˆSQLæœ€é©åŒ–ï¼ˆEXPLAIN + ã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼‰ã‚’å®Ÿè¡Œ
7. **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: ã‚»ãƒ«49-50ã§æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆãƒ»æ¨æ•²

### é‡è¦ãªå‡¦ç†ã®æµã‚Œ

**çµ±åˆSQLæœ€é©åŒ–å‡¦ç†ï¼ˆã‚»ãƒ«43ï¼‰**:
1. **ã‚¹ãƒ†ãƒƒãƒ—1**: ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¯ã‚¨ãƒªã®EXPLAINå®Ÿè¡Œï¼ˆPhotonå¯¾å¿œçŠ¶æ³åˆ†æï¼‰
2. **ã‚¹ãƒ†ãƒƒãƒ—2**: LLMæœ€é©åŒ– & æ¤œè¨¼EXPLAINå®Ÿè¡Œï¼ˆæœ€å¤§3å›è‡ªå‹•ã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼‰
3. **å‡ºåŠ›**: æœ€é©åŒ–SQLãƒ•ã‚¡ã‚¤ãƒ«ã¨è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ

## ğŸ“Š æŠ€è¡“ä»•æ§˜

### å¯¾å¿œãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼å½¢å¼
- **Databricks SQL Profiler JSON**: ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ
- **ã‚¯ã‚¨ãƒªå®Ÿè¡Œãƒ—ãƒ©ãƒ³**: è©³ç´°ãªãƒãƒ¼ãƒ‰åˆ†æå¯¾å¿œ
- **ãƒ¡ãƒˆãƒªã‚¯ã‚¹æƒ…å ±**: å®Ÿè¡Œæ™‚é–“ã€ãƒ¡ãƒ¢ãƒªã€I/Oã€ä¸¦åˆ—åº¦

### æœ€é©åŒ–æŠ€è¡“
- **çµ±è¨ˆãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**: EXPLAIN COSTã®çµ±è¨ˆæƒ…å ±ã‚’æ´»ç”¨ã—ãŸç²¾å¯†æœ€é©åŒ–
- **BROADCASTãƒ’ãƒ³ãƒˆ**: 30MBé–¾å€¤ã«åŸºã¥ãæ­£ç¢ºãªé©ç”¨åˆ¤å®š
- **REPARTITIONãƒ’ãƒ³ãƒˆ**: ã‚¹ãƒ”ãƒ«æ¤œå‡ºæ™‚ã®é©åˆ‡ãªå†åˆ†æ•£
- **Photonæœ€é©åŒ–**: æœªå¯¾å¿œé–¢æ•°ã®æ¤œå‡ºã¨ä»£æ›¿ææ¡ˆ
- **Liquid Clustering**: ãƒ‡ãƒ¼ã‚¿é…ç½®æˆ¦ç•¥ã®æœ€é©åŒ–

### ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ»è‡ªå‹•ä¿®æ­£
- **å¯¾å¿œã‚¨ãƒ©ãƒ¼**: AMBIGUOUS_REFERENCE, UNRESOLVED_COLUMN, PARSE_SYNTAX_ERRORç­‰
- **PARSE_SYNTAX_ERRORç‰¹åˆ¥å¯¾å¿œ**: JOINå¥å†…ã®BROADCASTãƒ’ãƒ³ãƒˆé…ç½®ã‚¨ãƒ©ãƒ¼ã‚’è‡ªå‹•ä¿®æ­£
- **ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½**: æœ€å¤§3å›ã®è‡ªå‹•ä¿®æ­£ï¼ˆè¨­å®šå¯èƒ½ï¼‰
- **ãƒ’ãƒ³ãƒˆä¿æŒ**: ä¿®æ­£ãƒ—ãƒ­ã‚»ã‚¹ä¸­ã‚‚BROADCAST/REPARTITIONãƒ’ãƒ³ãƒˆã‚’ç¶­æŒ
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ä¿®æ­£å¤±æ•—æ™‚ã¯å…ƒã‚¯ã‚¨ãƒªã§å®‰å…¨ã«å®Ÿè¡Œ
- **ğŸš¨ LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™å¯¾ç­–**: å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•åˆ‡ã‚Šè©°ã‚æ©Ÿèƒ½

#### ğŸ› ï¸ PARSE_SYNTAX_ERRORè‡ªå‹•ä¿®æ­£æ©Ÿèƒ½

**å•é¡Œ**: JOINå¥å†…ã®BROADCASTãƒ’ãƒ³ãƒˆé…ç½®ã«ã‚ˆã‚‹æ§‹æ–‡ã‚¨ãƒ©ãƒ¼

```sql
âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã‚³ãƒ¼ãƒ‰:
join /*+ BROADCAST(i) */ item i ON ss.ss_item_sk = i.i_item_sk
-- Syntax error at or near '/*+'. SQLSTATE: 42601

âœ… è‡ªå‹•ä¿®æ­£å¾Œ:
SELECT /*+ BROADCAST(i) */ ...
FROM store_sales ss
  JOIN item i ON ss.ss_item_sk = i.i_item_sk
```

**ä¿®æ­£ãƒ—ãƒ­ã‚»ã‚¹**:
1. **LLMä¿®æ­£**: è©³ç´°ãªä¿®æ­£ä¾‹ã¨ãƒ«ãƒ¼ãƒ«ã«ã‚ˆã‚‹æŒ‡å°
2. **ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ä¿®æ­£**: LLMå¤±æ•—æ™‚ã®å¼·åˆ¶çš„ãªå¾Œå‡¦ç†
3. **æ¤œè¨¼**: ä¿®æ­£å¾Œã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼æ®‹å­˜ãƒã‚§ãƒƒã‚¯
4. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ä¿®æ­£å¤±æ•—æ™‚ã¯å…ƒã‚¯ã‚¨ãƒªã‚’å®‰å…¨ä½¿ç”¨

#### ğŸš€ å“è³ªæ”¹å–„æ©Ÿèƒ½ (v2.7)

**å•é¡Œè§£æ±º**: AMBIGUOUS_REFERENCEã«ã‚ˆã‚‹ã‚»ãƒ«45å“è³ªåŠ£åŒ–

**å®Ÿè£…ã•ã‚ŒãŸæ”¹å–„**:
- **ğŸ”§ å…ƒã‚¯ã‚¨ãƒªäº‹å‰ä¿®æ­£**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒå‰ã®AMBIGUOUS_REFERENCEè§£æ±º
- **ğŸ’¾ ä¿®æ­£æ¸ˆã¿ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥**: é‡è¤‡å‡¦ç†é˜²æ­¢ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š  
- **ğŸ” å¼·åŒ–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
- **âš¡ é‡è¤‡å‡¦ç†å‰Šæ¸›**: ä¸è¦ãªEXPLAINå®Ÿè¡Œã®æ’é™¤

**åŠ¹æœ**:
- âŒ `[AMBIGUOUS_REFERENCE] Reference 'ss_item_sk' is ambiguous` â†’ âœ… äº‹å‰è§£æ±º
- âŒ `âš ï¸ EXPLAIN COSTå–å¾—å¤±æ•—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã‚’ã‚¹ã‚­ãƒƒãƒ—` â†’ âœ… æ­£å¸¸å®Ÿè¡Œ
- âŒ é‡è¤‡ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ»å‡¦ç†æ™‚é–“å¢—å¤§ â†’ âœ… åŠ¹ç‡çš„ãªå˜ä¸€å‡¦ç†

#### ğŸš¨ ç·Šæ€¥ãƒ‡ã‚°ãƒ¬ä¿®æ­£ (v2.7.1)

**é‡å¤§ãªå•é¡Œ**: EXPLAIN COSTå¤±æ•—æ™‚ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡ãŒå®Œå…¨ã«ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹é‡å¤§ãªãƒ‡ã‚°ãƒ¬ã‚’ç™ºè¦‹ãƒ»ä¿®æ­£

**å•é¡Œã®è©³ç´°**:
```
âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼å ±å‘Š: ã€Œå…ƒã®ã‚¯ã‚¨ãƒªã¨æœ€é©åŒ–ã‚¯ã‚¨ãƒªã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸ŠãŒã‚ã‚‹ã‹ã®è©•ä¾¡ã‚’ã—ã¦ã„ãªã„ã€
âŒ æ ¹æœ¬åŸå› : EXPLAIN COSTå¤±æ•— â†’ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã‚¹ã‚­ãƒƒãƒ— â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è©•ä¾¡çµæœãªã—
âŒ å½±éŸ¿: æœ€é©åŒ–åŠ¹æœãŒå…¨ãåˆ†ã‹ã‚‰ãªã„çŠ¶æ…‹
```

**ç·Šæ€¥ä¿®æ­£å†…å®¹**:
- **ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡**: EXPLAIN COSTå¤±æ•—æ™‚ã§ã‚‚EXPLAINçµæœã§ãƒ—ãƒ©ãƒ³åˆ†æ
- **ğŸ“Š ãƒ—ãƒ©ãƒ³è¤‡é›‘åº¦æ¯”è¼ƒ**: JOIN/Photon/Shuffleæ“ä½œæ•°ã¨ãƒ—ãƒ©ãƒ³æ·±åº¦ã®è©³ç´°æ¯”è¼ƒ
- **ğŸ¯ æ”¹å–„/æ‚ªåŒ–åˆ¤å®š**: å®Ÿè¡Œãƒ—ãƒ©ãƒ³æ§‹é€ ã‹ã‚‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¤‰åŒ–ã‚’æ¨å®š
- **ğŸ“‹ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ**: ä¿¡é ¼åº¦ãƒ»åˆ¶é™äº‹é …ãƒ»æ¨å¥¨äº‹é …ã‚’æ˜è¨˜ã—ãŸé€æ˜æ€§ã®é«˜ã„è©•ä¾¡

#### ğŸš« æ ¹æœ¬çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒä¿®æ­£ (v2.7.2)

**é‡å¤§ãªè¨­è¨ˆãƒŸã‚¹**: æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹æ§‹æ–‡ä¿®æ­£ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®å®Œå…¨å»ƒæ­¢

**ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡æ‘˜ã®å•é¡Œ**:
```
âŒ ã€Œæ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹ä¿®æ­£ã¯ç„¡é§„ - LLMãŒç”Ÿæˆã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«éš›é™ã¯ãªã„ã€
âŒ è‡´å‘½çš„æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ï¼ˆi.i_item_sk ss.ss_item_skï¼‰ãŒä¿®æ­£ã•ã‚Œãšæ­£å¸¸çµ‚äº†æ‰±ã„
âŒ æ ¹æœ¬çš„ã«é–“é•ã£ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§å“è³ªåŠ£åŒ–
```

**å®Œå…¨ä¿®æ­£å†…å®¹**:
- **ğŸš« æ­£è¦è¡¨ç¾ä¿®æ­£å®Œå…¨å»ƒæ­¢**: fix_common_ambiguous_referencesç­‰ã®æ„šã‹ãªä¿®æ­£ã‚’å‰Šé™¤
- **ğŸ¤– LLMä¸­å¿ƒä¿®æ­£**: å…¨ã¦ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’LLMã®é«˜åº¦ãªç†è§£åŠ›ã«å®Œå…¨ä¾å­˜
- **ğŸš¨ å…ƒã‚¯ã‚¨ãƒªLLMä¿®æ­£**: å…ƒã®ã‚¯ã‚¨ãƒªã§ã‚¨ãƒ©ãƒ¼æ¤œå‡ºæ™‚ã‚‚å³åº§ã«LLMä¿®æ­£å®Ÿè¡Œ
- **ğŸ“ è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: ã‚«ãƒ³ãƒæŠœã‘ãƒ»äºŒé‡ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç­‰ã®å…·ä½“ä¾‹ã‚’æ˜è¨˜

**ä¿®æ­£ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹**:
- **ã‚«ãƒ³ãƒæŠœã‘ã‚¨ãƒ©ãƒ¼**: `i.i_item_sk ss.ss_item_sk` â†’ `i.i_item_sk, ss.ss_item_sk`
- **äºŒé‡ã‚¨ã‚¤ãƒªã‚¢ã‚¹**: `iss.i.i_brand_id` â†’ `iss.i_brand_id`
- **ä¸‰é‡ã‚¨ã‚¤ãƒªã‚¢ã‚¹**: `ss.ss.ss_item_sk` â†’ `ss.ss_item_sk`
- **å­˜åœ¨ã—ãªã„å‚ç…§**: `this_year.i.i_brand_id` â†’ `this_year.i_brand_id`

**å®‰å…¨ä¿è¨¼**:
- âœ… å…ƒã®ã‚¯ã‚¨ãƒªã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã‚‚å³åº§ã«LLMä¿®æ­£
- âœ… æ„šã‹ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‹ã‚‰é«˜åº¦ãªæ–‡è„ˆç†è§£ã¸
- âœ… LLMã®å„ªã‚ŒãŸæ§‹æ–‡ç†è§£èƒ½åŠ›ã‚’æœ€å¤§æ´»ç”¨

#### ğŸš¨ åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ä¸æ•´åˆä¿®æ­£ (v2.7.3)

**é‡å¤§ãªå•é¡Œ**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ¤å®šã§çŸ›ç›¾ã—ãŸçµæœãŒå‡ºåŠ›ã•ã‚Œã‚‹é‡å¤§ãªä¸æ•´åˆ

**ãƒ¦ãƒ¼ã‚¶ãƒ¼å ±å‘Šã®å•é¡Œ**:
```
âŒ åŒä¸€å‡¦ç†ã§ç•°ãªã‚‹æ•°å€¤: 1.18å€ vs 1.03å€
âŒ è«–ç†çŸ›ç›¾: 1.18å€ï¼ˆ18%æ‚ªåŒ–ï¼‰ãªã®ã«ã€Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã‚’ç¢ºèªã€
âŒ å¢ƒç•Œå€¤ã§ã®åˆ¤å®šä¸æ•´åˆ: 1.18å€ãŒé–¾å€¤1.18ã¨åŒå€¤ã§åˆ¤å®šãŒæ›–æ˜§
```

**å®Œå…¨ä¿®æ­£å†…å®¹**:
- **ğŸš¨ åˆ¤å®šé–¾å€¤ã®æ˜ç¢ºåŒ–**: 10%ã§æ‚ªåŒ–åˆ¤å®šï¼ˆæ—§15%+3%ãƒãƒ¼ã‚¸ãƒ³=18%ï¼‰
- **ğŸ“Š å¢ƒç•Œå€¤ä¸æ•´åˆè§£æ±º**: ãƒãƒ¼ã‚¸ãƒ³ã‚’å»ƒæ­¢ã—ã€æ˜ç¢ºãªé–¾å€¤è¨­å®š
- **ğŸ¯ è«–ç†çš„ä¸€è²«æ€§ç¢ºä¿**: æ‚ªåŒ–æ¤œå‡ºæ™‚ã¯å¿…ãšå…ƒã‚¯ã‚¨ãƒªæ¨å¥¨
- **âš ï¸ è©³ç´°åˆ¤å®šã®æ•´åˆæ€§**: ã€Œè»½å¾®å¢—åŠ ã€ã¨ã€Œæ‚ªåŒ–ã€ã‚’æ˜ç¢ºã«åŒºåˆ¥

**ğŸš¨ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚ã«ã‚ˆã‚‹å³æ ¼åŒ– (v2.7.3.1)**:
- **å®Ÿè¡Œã‚³ã‚¹ãƒˆå¢—åŠ **: 1%ä»¥ä¸Šå¢—åŠ ã§å…ƒã‚¯ã‚¨ãƒªæ¨å¥¨ï¼ˆå³æ ¼åŒ–ï¼‰
- **ãƒ¡ãƒ¢ãƒªå¢—åŠ **: 1%ä»¥ä¸Šå¢—åŠ ã§å…ƒã‚¯ã‚¨ãƒªæ¨å¥¨ï¼ˆå³æ ¼åŒ–ï¼‰
- **æ”¹å–„**: 1%ä»¥ä¸Šå‰Šæ¸›ã§æœ€é©åŒ–ã‚¯ã‚¨ãƒªæ¨å¥¨ï¼ˆå³æ ¼åŒ–ï¼‰
- **åŒç­‰**: 0.99-1.01å€ã§å¤‰åŒ–ãªã—åˆ¤å®š

#### ğŸ”„ åå¾©æœ€é©åŒ–ã®å³æ ¼åŒ– (v2.7.3.2)

**ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚**: B. ã‚ˆã‚Šå³æ ¼ãªå‹•ä½œï¼ˆæ˜ç¢ºãªæ”¹å–„ã®ã¿æˆåŠŸï¼‰

**ä¿®æ­£å‰ã®å‹•ä½œ**:
```
âœ… æ‚ªåŒ–ãªã—ï¼ˆåŒç­‰å«ã‚€ï¼‰ â†’ 1å›ã§æˆåŠŸ
ğŸ”„ æ‚ªåŒ–ã®ã¿ â†’ æœ€å¤§3å›è©¦è¡Œ
```

**ä¿®æ­£å¾Œã®å‹•ä½œ**:
```
âœ… æ˜ç¢ºãªæ”¹å–„ï¼ˆ1%ä»¥ä¸Šï¼‰ â†’ 1å›ã§æˆåŠŸ
ğŸ”„ åŒç­‰ãƒ»æ‚ªåŒ–ï¼ˆæ˜ç¢ºãªæ”¹å–„ãªã—ï¼‰ â†’ æœ€å¤§3å›è©¦è¡Œ
```

**æŠ€è¡“å®Ÿè£…**:
- **ğŸ†• `significant_improvement_detected`ãƒ•ãƒ©ã‚°è¿½åŠ **: 1%ä»¥ä¸Šæ”¹å–„æ¤œå‡º
- **ğŸš¨ å³æ ¼åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯**: æ˜ç¢ºãªæ”¹å–„ãŒãªã„å ´åˆã¯å¿…ãšå†è©¦è¡Œ
- **ğŸ”„ åå¾©æœ€é©åŒ–å¼·åŒ–**: åŒç­‰çµæœã§ã‚‚å†æœ€é©åŒ–ã‚’å®Ÿè¡Œ
- **ğŸ“Š ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©•ä¾¡å¯¾å¿œ**: EXPLAIN COSTå¤±æ•—æ™‚ã‚‚å³æ ¼åˆ¤å®šé©ç”¨

#### ğŸš¨ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒäºŒé‡å®Ÿè¡Œãƒã‚°ä¿®æ­£ (v2.7.3.3)

**ãƒ¦ãƒ¼ã‚¶ãƒ¼å ±å‘Šã®é‡å¤§ãªå•é¡Œ**:
```
âŒ å®Ÿè¡Œã‚³ã‚¹ãƒˆæ¯”: 0.81å€ (19%æ”¹å–„) â†’ æˆåŠŸè¡¨ç¤º
âŒ ç›´å¾Œã«ã€ŒğŸ” è©¦è¡Œ2: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ‚ªåŒ–æ¤œå‡ºã‚’å®Ÿè¡Œã€
âŒ ç•°ãªã‚‹çµæœ: 1.24å€ â†’ æ‚ªåŒ–åˆ¤å®š
```

**æ ¹æœ¬åŸå› **: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã®äºŒé‡å®Ÿè¡Œ
- `execute_explain_with_retry_logic`ã§ç¬¬1å›ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
- `execute_iterative_optimization_with_degradation_analysis`ã§ç¬¬2å›ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
- ç•°ãªã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®å®Ÿè¡Œã«ã‚ˆã‚ŠçŸ›ç›¾ã—ãŸçµæœ

**å®Œå…¨ä¿®æ­£å†…å®¹**:
- **ğŸš¨ äºŒé‡å®Ÿè¡Œã®æ’é™¤**: `execute_explain_with_retry_logic`ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã‚’ç„¡åŠ¹åŒ–
- **ğŸ¯ ä¸€å…ƒåŒ–**: `execute_iterative_optimization_with_degradation_analysis`ã§ã®ã¿å®Ÿè¡Œ
- **ğŸ“Š ä¸€è²«æ€§ç¢ºä¿**: åŒä¸€æ¡ä»¶ã§ã®å˜ä¸€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡
- **ğŸ”§ æ§‹æ–‡ãƒã‚§ãƒƒã‚¯åˆ†é›¢**: æ§‹æ–‡æˆåŠŸã¯å³åº§ã«æ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã¸

**ä¿®æ­£å¾Œã®æµã‚Œ**:
1. `execute_explain_with_retry_logic`: æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã®ã¿
2. `execute_iterative_optimization_with_degradation_analysis`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
3. æ˜ç¢ºãªæ”¹å–„æ¤œå‡ºæ™‚: å³åº§ã«æˆåŠŸçµ‚äº†
4. æ”¹å–„ä¸ååˆ†æ™‚: æœ€å¤§3å›å†è©¦è¡Œ

**ä¿å®ˆçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®å¼·åŒ–**:
- âœ… 1%ã§ã‚‚å¢—åŠ  â†’ å³åº§ã«å…ƒã‚¯ã‚¨ãƒªæ¨å¥¨
- âœ… 1%ä»¥ä¸Šæ”¹å–„ â†’ æœ€é©åŒ–ã‚¯ã‚¨ãƒªæ¨å¥¨  
- ğŸ”„ åŒç­‰ï¼ˆ0.99-1.01å€ï¼‰ â†’ æœ€å¤§3å›å†è©¦è¡Œã§æ”¹å–„ã‚’è¿½æ±‚
- âœ… ã€Œè¨±å®¹ç¯„å›²ã€æ¦‚å¿µã‚’æ’é™¤
- âœ… æ˜ç¢ºãªæ”¹å–„ãŒãªã„é™ã‚Šå¦¥å”ã—ãªã„
- âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã®ä¸€è²«æ€§ä¿è¨¼**

#### ğŸš¨ åå¾©æœ€é©åŒ–æ©Ÿèƒ½ä¿®æ­£ (v2.7.3.4)

**ãƒ¦ãƒ¼ã‚¶ãƒ¼å ±å‘Šã®é‡å¤§ãªå•é¡Œ**:
```
âŒ 3å›ã¨ã‚‚å…¨ãåŒã˜çµæœ: ã‚³ã‚¹ãƒˆæ¯” 1.20å€
âŒ æ‚ªåŒ–åˆ†æãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„
âŒ LLMãŒåŒã˜ã‚¯ã‚¨ãƒªã‚’3å›ç”Ÿæˆ
```

**æ ¹æœ¬åŸå› **: é–“é•ã£ãŸé–¢æ•°ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ‚ªåŒ–ä¿®æ­£ã‚’å®Ÿè¡Œ
- **æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ä¿®æ­£ç”¨**ã®`generate_optimized_query_with_error_feedback`ã‚’ä½¿ç”¨
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ‚ªåŒ–ä¿®æ­£**ã«ä¸é©åˆ‡ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- LLMãŒã€Œã‚¨ãƒ©ãƒ¼ä¿®æ­£ã€æ–‡è„ˆã§å—ã‘å–ã‚Šã€æ”¹å–„æŒ‡ç¤ºã‚’ç„¡è¦–

**å®Œå…¨è§£æ±ºç­–**:
- **ğŸ†• å°‚ç”¨é–¢æ•°è¿½åŠ **: `generate_improved_query_for_performance_degradation`
- **ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ‚ªåŒ–å°‚ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: æ ¹æœ¬çš„æ”¹å–„ã«ç‰¹åŒ–
- **ğŸ“Š æ‚ªåŒ–åŸå› åˆ†æã®è©³ç´°æ´»ç”¨**: å…·ä½“çš„ä¿®æ­£æŒ‡ç¤ºã‚’LLMã«ä¼é”
- **ğŸ”§ åå¾©æœ€é©åŒ–ãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£**: é©åˆ‡ãªé–¢æ•°ã‚’å‘¼ã³å‡ºã—

**æ–°ã—ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**:
- **éå‰°æœ€é©åŒ–ã®æ˜¯æ­£**: BROADCASTãƒ’ãƒ³ãƒˆã®è¦‹ç›´ã—
- **JOINåŠ¹ç‡åŒ–**: æ“ä½œæ•°å¢—åŠ ã®å›é¿
- **ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºæœ€é©åŒ–**: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ—ãƒƒã‚·ãƒ¥ãƒ€ã‚¦ãƒ³å¼·åŒ–
- **ä¿å®ˆçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: ç¢ºå®Ÿãªæ”¹å–„ã®ã¿é©ç”¨

**ä¿®æ­£å¾Œã®æœŸå¾…åŠ¹æœ**:
- âœ… è©¦è¡Œã”ã¨ã«ç•°ãªã‚‹ã‚¯ã‚¨ãƒªç”Ÿæˆ
- âœ… æ‚ªåŒ–åŸå› ã«å¿œã˜ãŸå…·ä½“çš„æ”¹å–„
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ç¢ºå®Ÿãªè¿½æ±‚
- âœ… æœ€å¤§3å›ã®åŠ¹æœçš„ãªæœ€é©åŒ–è©¦è¡Œ

#### ğŸš¨ é‡å¤§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¿®æ­£ (v2.7.3.5)

**ãƒ¦ãƒ¼ã‚¶ãƒ¼å ±å‘Šã®æ·±åˆ»ãªå•é¡Œ**:
```
âŒ UNRESOLVED_COLUMN.WITH_SUGGESTIONã‚¨ãƒ©ãƒ¼å¾Œã«æœ€é©åŒ–è©¦è¡ŒãŒåœæ­¢
âŒ list index out of range ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ  
âŒ ã‚¨ãƒ©ãƒ¼å¾Œã®åå¾©æœ€é©åŒ–ãŒæ©Ÿèƒ½ã—ãªã„
âŒ ã„ã„åŠ æ¸›ã«ã—ã¦ãã ã•ã„ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å¼·ã„è‹¦æƒ…ï¼‰
```

**æ ¹æœ¬åŸå› åˆ†æ**:
1. **æœªå¯¾å¿œã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³**: `UNRESOLVED_COLUMN.WITH_SUGGESTION`ãŒå†è©¦è¡Œå¯¾è±¡å¤–
2. **ãƒªã‚¹ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼**: `optimization_attempts[-1]`ã®å®‰å…¨ãƒã‚§ãƒƒã‚¯ä¸è¶³
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡å¤±æ•—æ™‚**: é©åˆ‡ãªç¶™ç¶šãƒ­ã‚¸ãƒƒã‚¯ã®æ¬ å¦‚

**å®Œå…¨ä¿®æ­£å†…å®¹**:

**1. ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³å®Œå…¨å¯¾å¿œ**:
```python
retryable_error_patterns = [
    # ... æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³
    "UNRESOLVED_COLUMN.WITH_SUGGESTION",      # ğŸ†• è¿½åŠ 
    "[UNRESOLVED_COLUMN.WITH_SUGGESTION]"     # ğŸ†• è¿½åŠ 
]
```

**2. ğŸ›¡ï¸ ãƒªã‚¹ãƒˆã‚¢ã‚¯ã‚»ã‚¹å®‰å…¨åŒ–**:
```python
# ä¿®æ­£å‰ï¼ˆå±é™ºï¼‰:
previous_attempt = optimization_attempts[-1]

# ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰:
if attempt_num > 1 and optimization_attempts:
    previous_attempt = optimization_attempts[-1]
```

**3. ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡å¤±æ•—æ™‚ã®ç¶™ç¶šå‡¦ç†**:
```python
if performance_comparison is None:
    optimization_attempts.append({
        'status': 'performance_evaluation_failed',
        'error': 'EXPLAIN COSTå®Ÿè¡Œå¤±æ•—ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©•ä¾¡å¤±æ•—'
    })
    if attempt_num < max_optimization_attempts:
        continue  # æ¬¡ã®è©¦è¡Œã«é€²ã‚€
```

**ä¿®æ­£åŠ¹æœ**:
- âœ… `UNRESOLVED_COLUMN.WITH_SUGGESTION`ã‚¨ãƒ©ãƒ¼ã®è‡ªå‹•ä¿®æ­£
- âœ… `list index out of range`ã‚¨ãƒ©ãƒ¼ã®å®Œå…¨æ’é™¤
- âœ… ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿå¾Œã‚‚åå¾©æœ€é©åŒ–ã®ç¶™ç¶šå®Ÿè¡Œ
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡å¤±æ•—æ™‚ã®é©åˆ‡ãªæ¬¡è©¦è¡Œç§»è¡Œ
- âœ… å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹å®Œå…¨æ€§ä¿è¨¼

### ğŸš¨ LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ã‚¨ãƒ©ãƒ¼ã®è§£æ±º

#### **ç™ºç”Ÿãƒ‘ã‚¿ãƒ¼ãƒ³**
```
âŒ APIã‚¨ãƒ©ãƒ¼: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ 400
ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {"error_code":"BAD_REQUEST","message":"Input is too long for requested model."}
```

#### **v2.6 è‡ªå‹•è¦ç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Œå…¨è§£æ±ºï¼‰**
- **è‡ªå‹•åˆ¤å®š**: 200KBè¶…ã®EXPLAIN+EXPLAIN COSTãƒ‡ãƒ¼ã‚¿ã‚’æ¤œå‡º
- **è¦ç´„å®Ÿè¡Œ**: LLMã«ã‚ˆã‚‹é‡è¦æƒ…å ±æŠ½å‡ºï¼ˆPhysical Planã€çµ±è¨ˆæƒ…å ±ã€PhotonçŠ¶æ³ï¼‰
- **åœ§ç¸®åŠ¹æœ**: å®Ÿæ¸¬ã§557KBâ†’373æ–‡å­—ï¼ˆç´„1,494xåœ§ç¸®ï¼‰
- **æƒ…å ±ä¿æŒ**: BroadcastHashJoinã€407.7GiBãƒ†ãƒ¼ãƒ–ãƒ«ã€198çµ±è¨ˆç­‰ã‚’æ­£ç¢ºæŠ½å‡º
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: LLMã‚¨ãƒ©ãƒ¼æ™‚ã‚‚åˆ‡ã‚Šè©°ã‚ç‰ˆã§å®‰å…¨å‹•ä½œ

#### **v2.5.1 è‡ªå‹•å¯¾ç­–æ©Ÿèƒ½ï¼ˆç·Šæ€¥å¯¾å¿œï¼‰**
- **EXPLAIN COSTçµ±è¨ˆ**: 50KBåˆ¶é™ï¼ˆç´„414KBâ†’50KBã«è‡ªå‹•åˆ‡ã‚Šè©°ã‚ï¼‰
- **Physical Plan**: 30KBåˆ¶é™ï¼ˆç´„70KBâ†’30KBã«è‡ªå‹•åˆ‡ã‚Šè©°ã‚ï¼‰
- **ã‚¨ãƒ©ãƒ¼æ¤œå‡º**: LLMã‚¨ãƒ©ãƒ¼ã‚’äº‹å‰æ¤œå‡ºã—ã¦SQLå®Ÿè¡Œã‚’é˜²æ­¢
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ã‚¨ãƒ©ãƒ¼æ™‚ã¯è‡ªå‹•çš„ã«å…ƒã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨

### ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- **æ¡ä»¶ä»˜ãä¿å­˜**: `DEBUG_ENABLED`è¨­å®šã«ã‚ˆã‚‹æŸ”è»Ÿãªãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- **EXPLAINçµæœä¿å­˜**: `EXPLAIN_ENABLED='Y'`ã§ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ»æœ€é©åŒ–å¾Œã‚¯ã‚¨ãƒªã®EXPLAIN & EXPLAIN COSTçµæœã‚’è­˜åˆ¥å¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜
- **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ä¸è¦ãªä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•å‰Šé™¤ï¼ˆè¨­å®šå¯èƒ½ï¼‰

## ğŸ“š æŠ€è¡“ä»•æ§˜

### EXPLAIN + EXPLAIN COSTè¦ç´„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆv2.6ï¼‰

#### **è¦ç´„æ©Ÿèƒ½ã®å‹•ä½œãƒ•ãƒ­ãƒ¼**
1. **ã‚µã‚¤ã‚ºåˆ¤å®š**: EXPLAIN + EXPLAIN COSTåˆè¨ˆãŒ200KBè¶…ã®å ´åˆã«è¦ç´„å®Ÿè¡Œ
2. **é‡è¦æƒ…å ±æŠ½å‡º**: 
   - Physical Planä¸»è¦æ“ä½œï¼ˆPhotonBroadcastHashJoinã€ShuffleExchangeç­‰ï¼‰
   - çµ±è¨ˆæƒ…å ±ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºã€è¡Œæ•°ã€rowCountã€sizeInBytesç­‰ï¼‰  
   - Photonåˆ©ç”¨çŠ¶æ³ã¨ãƒ™ã‚¯ãƒˆãƒ«åŒ–å‡¦ç†ã®é©ç”¨ç¯„å›²
3. **LLMè¦ç´„**: 5000æ–‡å­—ä»¥å†…ã®ç°¡æ½”ãªåˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
4. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: LLMã‚¨ãƒ©ãƒ¼æ™‚ã¯åˆ‡ã‚Šè©°ã‚ç‰ˆï¼ˆ30KBåˆ¶é™ï¼‰ã§ç¶™ç¶š

#### **è¦ç´„å“è³ªã®ä¿è¨¼**
- **æƒ…å ±æ¼ã‚Œé˜²æ­¢**: é‡è¦ãªçµ±è¨ˆå€¤ï¼ˆGiBã€rowCountï¼‰ã¯æ•°å€¤ãƒ™ãƒ¼ã‚¹ã§æŠ½å‡º
- **JOINæ–¹å¼ä¿æŒ**: BROADCASTåˆ¤å®šã«é‡è¦ãªæƒ…å ±ã‚’å„ªå…ˆçš„ã«ä¿æŒ
- **PhotonçŠ¶æ³**: æœ€é©åŒ–å¯¾è±¡ã¨ãªã‚‹éå¯¾å¿œæ“ä½œã®æ˜ç¢ºåŒ–
- **åœ§ç¸®ç‡ç®¡ç†**: å¹³å‡100-1000xåœ§ç¸®ã§LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ã‚’ç¢ºå®Ÿã«å›é¿

#### **æ‰‹å‹•è¨­å®šï¼ˆé€šå¸¸ä¸è¦ï¼‰**
```python
# è¦ç´„é–¾å€¤ã®èª¿æ•´ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 200KBï¼‰
SUMMARIZATION_THRESHOLD = 200000

# LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ã®èª¿æ•´ï¼ˆç·Šæ€¥æ™‚ã®ã¿ï¼‰
LLM_CONFIG["databricks"]["max_tokens"] = 65536      # 64Kåˆ¶é™
LLM_CONFIG["databricks"]["thinking_budget_tokens"] = 32768  # 32Kæ€è€ƒäºˆç®—

# å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿å¯¾ç­–ï¼ˆéæ¨å¥¨ï¼šè¦ç´„æ©Ÿèƒ½ä½¿ç”¨ã‚’æ¨å¥¨ï¼‰
DEBUG_ENABLED = 'N'        # ä¸­é–“ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šæ¸›
EXPLAIN_ENABLED = 'N'      # EXPLAINå®Ÿè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ä¾‹

### å®Ÿéš›ã®æ”¹å–„ã‚±ãƒ¼ã‚¹

**å¤§è¦æ¨¡JOINæœ€é©åŒ–**:
- **å®Ÿè¡Œæ™‚é–“**: 45åˆ† â†’ 12åˆ†ï¼ˆ73%çŸ­ç¸®ï¼‰
- **ãƒ¡ãƒ¢ãƒªã‚¹ãƒ”ãƒ«**: 8.5GB â†’ 0GBï¼ˆå®Œå…¨è§£æ¶ˆï¼‰
- **é©ç”¨æŠ€è¡“**: BROADCAST + REPARTITION + Photonæœ€é©åŒ–

**ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¥ãƒ¼è§£æ±º**:
- **ã‚¿ã‚¹ã‚¯åˆ†æ•£**: ä¸å‡ç­‰ï¼ˆæœ€å¤§8å€å·®ï¼‰ â†’ å‡ç­‰ï¼ˆ1.2å€å·®ä»¥å†…ï¼‰
- **å®Ÿè¡Œæ™‚é–“**: 28åˆ† â†’ 9åˆ†ï¼ˆ68%çŸ­ç¸®ï¼‰
- **é©ç”¨æŠ€è¡“**: Liquid Clustering + é©åˆ‡ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°

## ğŸ†• æœ€æ–°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

### v2.6 - ğŸš¨ EXPLAIN/EXPLAIN COSTè¦ç´„æ©Ÿèƒ½ã«ã‚ˆã‚‹LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™å®Œå…¨è§£æ±º (NEW)
- **å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ**: 545KBâ†’5KBç¨‹åº¦ï¼ˆç´„100xåœ§ç¸®ï¼‰ã§åŒ…æ‹¬ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’å®‰å®šåŒ–
- **è‡ªå‹•è¦ç´„ã‚·ã‚¹ãƒ†ãƒ **: 200KBè¶…ã®EXPLAINçµæœã‚’è‡ªå‹•è¦ç´„ã—ã¦LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ã‚’å›é¿
- **é‡è¦æƒ…å ±ä¿æŒ**: Physical Planã€çµ±è¨ˆæƒ…å ±ã€PhotonçŠ¶æ³ã‚’æ¼ã‚ŒãªãæŠ½å‡ºãƒ»è¦ç´„
- **å …ç‰¢ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: LLMã‚¨ãƒ©ãƒ¼æ™‚ã‚‚åˆ‡ã‚Šè©°ã‚ç‰ˆã§ç¶™ç¶šå‹•ä½œä¿è¨¼
- **å®Ÿè¨¼æ¸ˆã¿åŠ¹æœ**: å®Ÿéš›ã®557KBãƒ•ã‚¡ã‚¤ãƒ«ã‚’373æ–‡å­—ã«åœ§ç¸®æˆåŠŸ

### v2.5.1 - ğŸš¨ ç·Šæ€¥ä¿®æ­£: LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ã‚¨ãƒ©ãƒ¼è§£æ±º
- **LLMãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬è§£æ±º**: 414KBè¶…ã®EXPLAIN COSTçµæœã«ã‚ˆã‚‹`Input is too long`ã‚¨ãƒ©ãƒ¼ã‚’é˜²æ­¢
- **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºåˆ¶é™**: EXPLAIN COSTçµ±è¨ˆ(50KB)ã€Physical Plan(30KB)ã®è‡ªå‹•åˆ‡ã‚Šè©°ã‚æ©Ÿèƒ½
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®SQLå®Ÿè¡Œé˜²æ­¢**: APIã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒSQLã‚¯ã‚¨ãƒªã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹å•é¡Œã‚’ä¿®æ­£
- **å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: LLMã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
- **è©³ç´°ãªã‚¨ãƒ©ãƒ¼è¨ºæ–­**: æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼åŸå› ã¨è§£æ±ºç­–ã®æç¤º

### v2.5 - EXPLAIN + EXPLAIN COSTçµ±åˆå¼·åŒ–
- **çµ±è¨ˆãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**: å®Ÿéš›ã®çµ±è¨ˆæƒ…å ±ã«ã‚ˆã‚‹ç²¾å¯†ãªåˆ¤å®š
- **æ”¹å–„ã•ã‚ŒãŸæ¤œå‡ºæ©Ÿèƒ½**: 87.5%ã®çµ±è¨ˆæƒ…å ±æ¤œå‡ºç‡ã‚’å®Ÿè¨¼
- **å®Ÿä¸–ç•Œå¯¾å¿œ**: 30å„„è¡Œè¶…ãƒ‡ãƒ¼ã‚¿ã€28.8MBã®BROADCASTåˆ¤å®šç­‰ã‚’ã‚µãƒãƒ¼ãƒˆ
- **ãƒ¡ãƒ¢ãƒªäºˆæ¸¬**: ã‚¹ãƒ”ãƒ«ç¢ºç‡ï¼ˆHIGH 78%ç­‰ï¼‰ã®äº‹å‰äºˆæ¸¬æ©Ÿèƒ½

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

- **æŠ€è¡“çš„ãªå•é¡Œ**: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ãƒ‡ãƒãƒƒã‚°æ”¯æ´
- **æœ€é©åŒ–ç›¸è«‡**: SQLæœ€é©åŒ–æˆ¦ç•¥ã®ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**: ç‰¹å®šç’°å¢ƒå‘ã‘ã®æ©Ÿèƒ½æ‹¡å¼µ

---

*Databricks SQL Profiler Analysis Tool - Advanced SQL Optimization with AI-Powered Analytics + Statistics-Based Precision* 